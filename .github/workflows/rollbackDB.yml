name: Rollback DB

on:
  workflow_dispatch:
    inputs:
      environment:
        description: |
          The environment of the database.
        required: true
        type: choice
        options: [demo, dev, dev2, dev3, dev4, dev5, dev6, dev7, pentest, test, training, stg, prod]
        default: dev
      action:
        description: |
          The liquibase action to run.
        required: true
        type: choice
        options: [validate, clear-checksums, rollback]
        default: validate
      tag:
        description: |
          Only required if rollback is selected.
          The Liquibase tag to roll back to
        type: string
        default: ""

env:
  DEPLOY_ENV: ${{ github.event.inputs.environment }}
  DOCKER_COMPOSE_FILE: docker-compose.db-liquibase-action.yml
  GIT_SHA: ${{ github.event.inputs.action }}
  LIQUIBASE_ROLLBACK_TAG: ${{ github.event.inputs.tag }}

jobs:

  db_rollback_action:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: DB Liquibase Rollback
        uses: ./.github/actions/db-actions
        with:
          environment: ${{ github.event.inputs.environment }}
          action: ${{ github.event.inputs.action }}
          tag: ${{ github.event.inputs.tag }}
